# Extend the schema

In this tutorial you extend the schema to add a table of historical counter values and the time in which the counter reached those values.
For the sake of simplicity, we will implement this in the `increment` function rather than use a [storage hook](/store/advanced-features#storage-hooks).

## Modify the MUD configuration file

1. In an editor, open `packages/contracts/mud.config.ts` and add this table definition:

   ```ts
      History: {
        keySchema: {
          counterValue: "uint32",
        },
        schema: {
          blockNumber: "uint256",
          time: "uint256"
        }
      },
   ```

<details>
<summary>The complete file</summary>

```ts
import { mudConfig } from "@latticexyz/world/register";

export default mudConfig({
  tables: {
    Counter: {
      keySchema: {},
      schema: "uint32",
    },
    History: {
      keySchema: {
        counterValue: "uint32",
      },
      schema: {
        blockNumber: "uint256",
        time: "uint256",
      },
    },
  },
});
```

</details>

<details>
<summary>Explanation</summary>

A MUD table has two schemas:

- `keySchema`, which is the key used to find entries
- `schema`, which is the value

</details>

2. Run this command in `packages/contracts` to regenerate the code.

   ```sh
   pnpm build:mud
   ```

## Update `IncrementSystem`

1. In an editor, open `packages/contracts/src/systems/IncrementSystem.sol`.

   - Modify the second `import` line to import `History`.

     ```solidity
     import { Counter, History, HistoryData } from "../codegen/Tables.sol";
     ```

   - Modify the `increment` function to also update `History` by adding this line just before `return newValue`.

     ```solidity
     History.set(newValue, block.number, block.timestamp);
     ```

     To see the exact functions that are available, you can look at `packages/contracts/src/codegen/tables/History.sol` (that is the reason we ran `pnpm build:mud`).

<details>
   <summary>
     The complete file
   </summary>

     ```solidity
     // SPDX-License-Identifier: MIT
     pragma solidity >=0.8.0;

     import { System } from "@latticexyz/world/src/System.sol";
     import { Counter, History, HistoryData } from "../codegen/Tables.sol";

     contract IncrementSystem is System {
       function increment() public returns (uint32) {
         uint32 counter = Counter.get();
         uint32 newValue = counter + 1;
         Counter.set(newValue);
         History.set(newValue, block.number, block.timestamp);
         return newValue;
       }
     }
     ```

</details>

2. Run this command in `packages/contracts` to rebuild everything this package produces.

```sh
pnpm build
```

## Update the user interface

You can already run the application and see in the MUD Dev Tools that there is a `:History` table and it gets updates when you click **Increment**.
Click the **Store data** tab and select the table **:History**.

However, you can also add the history to the user interface.
The directions here apply to the `vanilla` user interface, if you use anything else you'll need to modify them as appropriate.

1. Install additional packages.
   Run these commands in `packages/client`.

   ```sh
   pnpm install @latticexyz/store-cache@main @latticexyz/store-sync@main
   ```

1. Edit `packages/clients/index.html` to add these lines just before `</body>`.

   ```html
   <hr />
   <h2>
     History for value:
     <select id="historyValue" onInput="window.readHistory(value)"></select>
   </h2>
   <table border>
     <tr>
       <th>Block number</th>
       <th>Time</th>
     </tr>
     <tr>
       <td id="blockNumber"></td>
       <td id="timeStamp"></td>
     </tr>
   </table>
   ```

<details>
  <summary>The complete file</summary>
  ```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>a minimal MUD client</title>
  </head>
  <body>
    <script type="module" src="/src/index.ts"></script>
    <div>Counter: <span id="counter">0</span></div>
    <button onclick="window.increment()">Increment</button>

{" "}
<hr />
<h2>
  History for value:
  <select id="historyValue" onInput="window.readHistory(value)"></select>
</h2>
<table border>
  <tr>
    <th>Block number</th>
    <th>Time</th>
  </tr>
  <tr>
    <td id="blockNumber"></td>
    <td id="timeStamp"></td>
  </tr>
</table>

  </body>
</html>  
  ```
</details>

3. Edit `packages/client/src/index.ts`.

   - Import two more functions we need.

     ```typescript
     import { encodeEntity } from "@latticexyz/store-sync/recs";
     import { getComponentValueStrict } from "@latticexyz/recs";
     ```

   - In `components.Counter.update$.subscribe`, add code that updates the selection of history values.

     ```typescript
     let options: String = "";
     for (let i = 0; i < nextValue?.value; i++) {
       options += `<option value="${i}">${i}</option>`;
     }
     document.getElementById("historyValue")!.innerHTML = options;
     ```

   - Add this function, called when the user selects a different option.

     ```typescript
     (window as any).readHistory = async (counterValue) => {
       const History = components.History;
       const entity = encodeEntity(History.metadata.keySchema, { counterValue });
       const { blockNumber, time } = getComponentValueStrict(History, entity);
       document.getElementById("blockNumber")!.innerHTML = blockNumber;
       document.getElementById("timeStamp")!.innerHTML = new Date(parseInt(time.toString()) * 1000);
     };
     ```

<details>
  <summary>The complete file</summary>
```
import { mount as mountDevTools } from "@latticexyz/dev-tools";
import { setup } from "./mud/setup";
import { encodeEntity } from "@latticexyz/store-sync/recs";
import { getComponentValueStrict } from "@latticexyz/recs";

const {
components,
systemCalls: { increment },
} = await setup();

// Components expose a stream that triggers when the component is updated.
components.Counter.update$.subscribe((update) => {
const [nextValue, prevValue] = update.value;
console.log("Counter updated", update, { nextValue, prevValue });
document.getElementById("counter")!.innerHTML = String(nextValue?.value ?? "unset");

let options: String = "";
for (let i = 0; i < nextValue?.value; i++) {
options += `<option value="${i}">${i}</option>`;
}
document.getElementById("historyValue")!.innerHTML = options;
});

// Just for demonstration purposes: we create a global function that can be
// called to invoke the Increment system contract via the world.
// (See IncrementSystem.sol)
(window as any).increment = async () => {
console.log("new counter value:", await increment());
};

(window as any).readHistory = async counterValue => {
const History = components.History
const entity = encodeEntity(History.metadata.keySchema, { counterValue });
const { blockNumber, time } = getComponentValueStrict(History, entity);
document.getElementById("blockNumber")!.innerHTML = blockNumber
document.getElementById("timeStamp")!.innerHTML = new Date(parseInt(time.toString()) \* 1000)
}

mountDevTools();

```
</details>
```
